<div class="account-list-container">
  <div class="page-header">
    <h1>{{ isAdmin ? 'All Accounts' : 'My Accounts' }}</h1>
    <div class="header-actions">
      <span *ngIf="!isAdmin" class="user-info">{{ currentUser?.fullName }}</span>
      <button mat-raised-button color="primary" routerLink="/accounts/new">
        <mat-icon>add</mat-icon>
        {{ isAdmin ? 'Create Account' : 'Open New Account' }}
      </button>
    </div>
  </div>

  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ isAdmin ? 'Account Management' : 'Your Accounts' }}</mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <!-- Search and Filter Section -->
      <div class="filters-section">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search accounts...</mat-label>
          <input matInput [(ngModel)]="searchTerm" (keyup)="applyFilters()" 
                 placeholder="Search by account number{{ isAdmin ? ' or customer name' : '' }}">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Account Type</mat-label>
          <mat-select [(ngModel)]="selectedAccountType" (selectionChange)="applyFilters()">
            <mat-option value="">All Types</mat-option>
            <mat-option value="SAVINGS">Savings</mat-option>
            <mat-option value="CURRENT">Current</mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-button (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Clear Filters
        </button>
      </div>

      <!-- Summary Stats -->
      <div class="summary-stats">
        <div class="stat-item">
          <span class="stat-label">{{ isAdmin ? 'Total Accounts' : 'Your Accounts' }}:</span>
          <span class="stat-value">{{ filteredAccounts.length }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">{{ isAdmin ? 'Total Balance' : 'Your Total Balance' }}:</span>
          <span class="stat-value">${{ getTotalBalance() | number:'1.2-2' }}</span>
        </div>
      </div>

      <!-- Loading Spinner -->
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Loading accounts...</p>
      </div>

      <!-- Accounts Table -->
      <div *ngIf="!isLoading" class="table-container">
        <table mat-table [dataSource]="filteredAccounts" class="accounts-table">
          
          <!-- Account Number Column -->
          <ng-container matColumnDef="accountNumber">
            <th mat-header-cell *matHeaderCellDef>Account Number</th>
            <td mat-cell *matCellDef="let account">
              <strong>{{ account.accountNumber }}</strong>
            </td>
          </ng-container>

          <!-- Customer Column - Only show for admin -->
          <ng-container matColumnDef="customerName" *ngIf="isAdmin">
            <th mat-header-cell *matHeaderCellDef>Customer</th>
            <td mat-cell *matCellDef="let account">
              <div class="customer-info">
                <span class="customer-name">{{ account.customerName }}</span>
                <small class="customer-id">ID: {{ account.customerId }}</small>
              </div>
            </td>
          </ng-container>

          <!-- Account Type Column -->
          <ng-container matColumnDef="accountType">
            <th mat-header-cell *matHeaderCellDef>Type</th>
            <td mat-cell *matCellDef="let account">
              <mat-chip [class]="'chip-' + account.accountType.toLowerCase()">
                {{ account.accountType }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Balance Column -->
          <ng-container matColumnDef="balance">
            <th mat-header-cell *matHeaderCellDef>Balance</th>
            <td mat-cell *matCellDef="let account" class="balance-cell">
              <span [class]="getBalanceClass(account.balance)">
                ${{ account.balance | number:'1.2-2' }}
              </span>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let account" class="actions-cell">
              <button mat-icon-button color="primary" [routerLink]="['/accounts', account.accountId]" 
                      matTooltip="View Details">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button color="accent" [routerLink]="['/customers', account.customerId]"
                      matTooltip="View Customer" *ngIf="isAdmin">
                <mat-icon>person</mat-icon>
              </button>
              <button mat-icon-button color="primary" [routerLink]="['/transactions/new']" 
                      [queryParams]="{accountId: account.accountId}"
                      matTooltip="Make Transaction">
                <mat-icon>swap_horiz</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deleteAccount(account.accountId!)"
                      matTooltip="Delete Account" *ngIf="isAdmin">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
              class="account-row" [routerLink]="['/accounts', row.accountId]"></tr>
        </table>

        <!-- No Data Message -->
        <div *ngIf="filteredAccounts.length === 0" class="no-data">
          <mat-icon>account_balance</mat-icon>
          <h3>{{ isAdmin ? 'No accounts found' : 'No accounts yet' }}</h3>
          <p>{{ searchTerm || selectedAccountType ? 'No accounts match your search criteria.' : 
               isAdmin ? 'No accounts have been created in the system yet.' : 'Start by opening your first account.' }}</p>
          <button mat-raised-button color="primary" routerLink="/accounts/new">
            <mat-icon>add</mat-icon>
            {{ isAdmin ? 'Create First Account' : 'Open First Account' }}
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>